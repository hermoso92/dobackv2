<!-- 304d7118-06a7-4ed5-9ddc-731c385a2960 1e8729f6-c36f-4421-9b12-3c5874360aad -->
# Plan De Auditoría Completa

## Objetivo

Revisar integralmente el Dashboard Manager y la página de Upload en frontend, backend y base de datos para detectar fallos funcionales, problemas de datos y brechas de autenticación.

## Pasos

1. **Inventario actual**

- Localizar componentes de frontend clave (`frontend/src/pages/UnifiedDashboard.tsx`, `frontend/src/components/Dashboard/**`, `frontend/src/pages/UploadPage.tsx`).
- Identificar servicios/hooks asociados (`useKPIs`, `useGlobalFilters`, `useFilteredData`, `uploadService`).
- Documentar endpoints consumidos (mapear con `frontend/src/config/api.ts`).

2. **Revisión frontend Dashboard**

- Inspeccionar cada tab (KPIs, Estados, Puntos Negros, Velocidad, Sesiones) confirmando dependencias y manejo de filtros.
- Verificar manejo de autenticación y carga inicial (`useOptimizedDashboard`, `AuthContext`).
- Analizar logs recientes en consola para detectar estados inconsistentes.

3. **Revisión frontend Upload**

- Revisar formulario de subida (`UploadPage`, componentes auxiliares).
- Confirmar validaciones, manejo de errores y llamada a servicios.

4. **Backend Dashboard endpoints**

- Auditar `backend/src/routes/kpis.ts`, `kpiRoutes.ts`, `hotspots.ts`, `telemetry-v2` y dependencias (servicios/queries Prisma).
- Confirmar uso de `validateOrganization` y filtros por organización en cada endpoint.
- Revisar caché, timeouts y estrategias de recalculo.

5. **Backend Upload endpoints**

- Revisar rutas de subida (`backend/src/routes/upload.ts` o equivalente) y servicios asociados.
- Verificar validaciones, manejo de metadata y guardado en DB/S3/presigned URLs.

6. **Base de datos**

- Analizar modelos Prisma relevantes (sessions, stability_events, uploads, vehicles, organizations).
- Revisar migraciones recientes y scripts en `database/`.
- Validar integridad de datos (ej. filtros por fecha, claves operacionales, relación parques).

7. **Pruebas integradas**

- Simular flujo Manager: login → filtros → tabs → exportación.
- Simular carga de archivos en Upload y seguimiento en backend (logs/DB).

8. **Informe de hallazgos**

- Listar issues por severidad con referencia a archivos/líneas o queries.
- Recomendar fixes o mejoras (caché, validaciones, UX).

## Resultados Esperados

- Mapa completo de dependencias y endpoints del dashboard y upload.
- Lista priorizada de bugs/incidencias y propuestas de solución.
- Confirmación de consistencia entre frontend, backend y datos para organización del Manager.

## Recursos Clave

- Frontend: `frontend/src/pages/UnifiedDashboard.tsx`, `frontend/src/components/Dashboard/**`, `frontend/src/pages/UploadPage.tsx`.
- Backend: `backend/src/routes/kpis.ts`, `hotspots.ts`, `telemetry-v2/**`, `routes/upload*.ts`, `middleware/validateOrganization.ts`.
- DB: `backend/prisma/schema.prisma`, migraciones y scripts en `database/`.